<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Boogaloo" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body onload="generateCheckboxes()">
    <script>
        var beat = 0;
        var timer = null;
        var chordObj = [
            { name: "C", checked: true, mainCat: "chordKey" },
            { name: "C#", checked: true, mainCat: "chordKey" },
            { name: "Db", checked: true, mainCat: "chordKey" },
            { name: "D", checked: true, mainCat: "chordKey" },
            { name: "D#", checked: true, mainCat: "chordKey" },
            { name: "Eb", checked: true, mainCat: "chordKey" },
            { name: "E", checked: true, mainCat: "chordKey" },
            { name: "E#", checked: false, mainCat: "chordKey" },
            { name: "Fb", checked: false, mainCat: "chordKey" },
            { name: "F", checked: true, mainCat: "chordKey" },
            { name: "F#", checked: true, mainCat: "chordKey" },
            { name: "Gb", checked: true, mainCat: "chordKey" },
            { name: "G", checked: true, mainCat: "chordKey" },
            { name: "G#", checked: true, mainCat: "chordKey" },
            { name: "Ab", checked: true, mainCat: "chordKey" },
            { name: "A", checked: true, mainCat: "chordKey" },
            { name: "A#", checked: false, mainCat: "chordKey" },
            { name: "Bb", checked: true, mainCat: "chordKey" },
            { name: "B", checked: true, mainCat: "chordKey" },
            { name: "H", checked: false, mainCat: "chordKey" },
            { name: "Cb", checked: false, mainCat: "chordKey" },
            { name: "maj<sup>7</sup>", checked: true, mainCat: "chordType" },
            { name: "-<sup>7</sup>", checked: true, mainCat: "chordType" },
            { name: "m<sup>7b5</sup>", checked: true, mainCat: "chordType" },
            { name: "<sup>7</sup>", checked: true, mainCat: "chordType" },
            { name: "sus<sup>4</sup>", checked: false, mainCat: "chordType" },
        ];
        const chordName = chordObj.name;
        console.log(chordName);
        console.log(chordObj)
        function showChordSymbol() {
            var meter = document.getElementById("meter-input").value;
            var chordKey = chordObj.filter(chordObj => {
                return chordObj.checked === true && chordObj.mainCat == "chordKey";
            })
            var chordType = chordObj.filter(chordObj => {
                return chordObj.checked === true && chordObj.mainCat == "chordType";
            })
            console.log(chordType);
            var chordSymbol = chordKey[Math.floor((Math.random() * chordKey.length) + 0)].name + chordType[Math.floor((Math.random() * chordType.length) + 0)].name;
            if (beat == meter) {
                document.getElementById("chord-symbol").innerHTML = chordSymbol;
                beat = 0;
            }
        };
        function tempo() {
            var beats = document.getElementById("bpm-input").value;
            var minute = 60000;
            tempo = minute / beats;
            return tempo;
        }
        function metronome() {
            document.getElementById("start-button").disabled = true;
            document.getElementById("meter-input").disabled = true;
            document.getElementById("bpm-input").disabled = true;
            const timer = setInterval(function () {
                var audio = new Audio("blip.wav");
                audio.play();
                showChordSymbol();
                beat++;
            }, tempo());
        };
        function generateCheckboxes() {
            chordObj.map(chord => {
                if (chord.checked == true) { var checked = "checked" } else { checked = "" } // generate checked attribute for respsective objects
                let checkBox = `<input type="checkbox" id="${chord.name}" onclick="addSelectionToObject('${chord.name}')" ${checked}>
                                    <label for="${chord.name}">${chord.name}</label>`
                document.getElementById(chord.mainCat + "-fieldset").innerHTML += checkBox
            })
        }
        function addSelectionToObject(id) {
            chordObj.map(chord => {
                if (chord.name == id) {
                    switch (chord.checked) {
                        case false:
                            chord.checked = true;
                            break;
                        case true:
                            chord.checked = false;
                            break;
                    }
                }
            })
        };
        function modal() {
            // Get the modal
            var modal = document.getElementById('modal');

            // Get the button that opens the modal
            var btn = document.getElementById("settings");

            // Get the <span> element that closes the modal
            var span = document.getElementsByClassName("close")[0];

            // When the user clicks the button, open the modal 
            modal.style.display = "block";

            // When the user clicks on <span> (x), close the modal
            span.onclick = function () {
                modal.style.display = "none";
            }

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }
    </script>

    <div id="wrapper">
        <div id="chord-symbol">
            Chord symbol generator
        </div>
        <div id="bottom-bar">
            <div>
                <input id="bpm-input" type="number" name="BMP" min="30" max="320" value="100" id="tempo"> BPM |
                <input id="meter-input" type="number" name="METER" min="1" max="9" value="4">/4
            </div>
            <div>
                <button id="start-button" onclick="metronome()">Start</button>
                <button onclick="location.reload()">Reset</button>
                <button id="settings" onclick="modal()">Settings</button>

            </div>
        </div>
    </div>
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Settings</h2>
            <fieldset id="chordKey-fieldset">
                <legend>Choose keys to include</legend>
            </fieldset>
            <fieldset id="chordType-fieldset">
                <legend>Choose chord types to include</legend>
            </fieldset>
        </div>
    </div>
</body>

</html>